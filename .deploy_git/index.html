<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>天问</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="wir mussen wissen. wir werden wissen">
<meta property="og:type" content="website">
<meta property="og:title" content="天问">
<meta property="og:url" content="https://liangkim.github.io/index.html">
<meta property="og:site_name" content="天问">
<meta property="og:description" content="wir mussen wissen. wir werden wissen">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天问">
<meta name="twitter:description" content="wir mussen wissen. wir werden wissen">
  
    <link rel="alternate" href="/atom.xml" title="天问" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/myblog/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/myblog/" id="logo">天问</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/myblog/" id="subtitle">上下未形，何由考之？</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/myblog/">Home</a>
        
          <a class="main-nav-link" href="/myblog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://liangkim.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/03/06/hello-world/" class="article-date">
  <time datetime="2017-03-06T12:28:08.000Z" itemprop="datePublished">2017-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/03/06/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/03/06/hello-world/" data-id="cj00y7kn8000di2ta7t0h0vsm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-如何阅读一本书" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/02/05/如何阅读一本书/" class="article-date">
  <time datetime="2017-02-05T13:53:51.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/读书笔记/">读书笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/02/05/如何阅读一本书/">如何阅读一本书</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>虽然手上已经有kindle了，但是还是忍不住要买实体书。昨天在京东上淘了四本书：《如何阅读一本书》、《肠子》、《数据结构C》、《人生的智慧》<br>肠子，这本书在大学时候就已经拜读过，当时觉得很惊艳，作者那冷酷的笔触和活灵活现的表达力让我印象深刻；既然我准备写点小说，那么这个作者应该是一个不错的模仿对象。而且他还有一些关于写作的小技巧发布，感觉还是挺有道理的。<br>人生的智慧，叔本华的亲民之作。悲观如叔本华，也是将他不可一世的悲观隐藏了起来，暂时地对“世俗性”妥协，写了这本劝人丰富自己精神世界的小书（实际上也不是专门写的，而是从另一部晚年著作中摘录出来的）。主要阐述的是一个人如何获取到幸福。<br>苦闷如我，还是需要这样的拯救。叔本华收小乘佛教影响颇深，所以他的哲学理论也带着一种无我超然的意味在里面，不可全信，但是里面对于幸福的分析还是颇有益处。这个等我读完了改天会专门写一篇读书笔记。关键点是他的三分法：自我、所有之物、他人眼中的自己。在他看来自我乃是唯一重要之事，这也契合他唯意志论的哲学观点；但是在这三种中，他人眼中的自己这一类描写最多，恐怕也与他的人生际遇有关。早年他的哲学论著无人问津，郁郁不得志自然要安慰自己说荣誉、社会地位实际上不那么重要。这样看来，这本书实际上是他整个人生的自传吧。<br>数据结构没什么好说的，就算不是为了考研，恶补一下计算机知识也是必要的。毕竟我不可能满足于现状，我需要更强才行。现在的我只是一个毫无上进心的码农而已。离程序员还差得远了，至少程序员根本不差钱。</p>
<p>好了，终于说到今天的重点了，那就是《如何阅读一本书》。<br>其实很多人并不会阅读，按照本书的四分法，阅读分为四个层次：基础阅读，检视阅读，分析阅读，比较阅读。四个层次互相包含，很多人其实仅仅止步于基础阅读，也就是说自从小学毕业以后，他们的阅读能力便没有再提升了。<br>阅读实际上是极为重要的，不仅增长了知识，也丰富了一个人的内涵，读万卷书，行万里路；若无法行万里路，那么万卷书就必不可少了。只有读书多了，才能成为一个真正有趣的人。<br>并且，光是读书还不够，毕竟有很多书呆子，看似读了很多书，然而实际上一点用了没有。他们的阅读是无效的，仅仅是读过，却没有真正消化所读的书。<br>我想区别就在于，阅读是否主动。主动的阅读能使人精神振奋，免于昏睡。<br>而主动与否的关键就是是否能够提出问题，并且有效的回答问题。<br>这本书实际上讲的就是提问题与回答问题的技巧。<br>现在就摘录一下各章的要点，等我读完了之后再总结一番，日后勤加练习必定神功大成。他日笑傲江湖可也。</p>
<h4 id="阅读的四个层次"><a href="#阅读的四个层次" class="headerlink" title="阅读的四个层次"></a>阅读的四个层次</h4><ul>
<li>基础阅读。明白书中的文字是在讲些什么</li>
<li>检视阅读。略读，尽快把握一本书的整体。判断这本书是否值得一读。分为两个阶段：1，系统性略读。具体实施方法就是读序、索引、目录等平时容易忽略的部分，尽快把握一本书的整体轮廓。2，粗读。大致把一本书从头到尾读一遍，遇到不懂就跳过。</li>
<li>分析阅读</li>
<li>比较阅读</li>
</ul>
<h4 id="主动性阅读的四个关键问题"><a href="#主动性阅读的四个关键问题" class="headerlink" title="主动性阅读的四个关键问题"></a>主动性阅读的四个关键问题</h4><ul>
<li>这本书在讲什么</li>
<li>这本书是怎么讲的</li>
<li>这本书讲的对吗</li>
<li>讲的东西和我有什么关系</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/02/05/如何阅读一本书/" data-id="cj00y7knj000ti2tatwjnmyoz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-C程序设计语言：第一章" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/02/05/C程序设计语言：第一章/" class="article-date">
  <time datetime="2017-02-05T12:38:48.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/C程序语言设计/">C程序语言设计</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/02/05/C程序设计语言：第一章/">C程序设计语言：第一章</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="题记"><a href="#题记" class="headerlink" title="题记"></a>题记</h4><p>总算要开始回头看C语言了，太久没用这门语言了，大概有5年了吧。<br>真是时光荏苒，但是为了进步，以及更高的编程愉悦感，我还是得忍着重新学习的痛苦，再回顾一遍这本经典的《C程序语言设计》了。<br>这里就记录一下心得，还有一些有趣的习题解答吧。</p>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><h5 id="1-5-2字符计数"><a href="#1-5-2字符计数" class="headerlink" title="1.5.2字符计数"></a>1.5.2字符计数</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * 练习1-8 编写一个统计空格、制表符、与换行符个数的程序</div><div class="line"> * */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</div><div class="line">    <span class="keyword">long</span> nc = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> ch;</div><div class="line">    <span class="keyword">while</span>( (ch = getchar())!= EOF )&#123;</div><div class="line">        <span class="keyword">if</span>(ch==<span class="string">'\n'</span> || ch==<span class="string">'\t'</span> || ch==<span class="string">' '</span>)&#123;</div><div class="line">            nc++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, nc);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * 练习1-9 编写一个将输入复制到输出的程序，并将其中连续的多个空格用一个空格替代</div><div class="line"> * */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> pre;</div><div class="line">    <span class="keyword">int</span> curr;</div><div class="line">    curr = getchar();</div><div class="line">    pre = <span class="number">-1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span>(curr!=EOF)&#123;</div><div class="line">        <span class="keyword">if</span>(curr!=<span class="string">' '</span>||pre!=<span class="string">' '</span>)&#123;</div><div class="line">            <span class="built_in">putchar</span>(curr);</div><div class="line">        &#125;</div><div class="line">        pre = curr;</div><div class="line">        curr = getchar();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/02/05/C程序设计语言：第一章/" data-id="cj00y7kmm0007i2tal42vsayl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/C/">C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/阅读笔记/">阅读笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lucune初体验" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/01/27/lucune初体验/" class="article-date">
  <time datetime="2017-01-27T08:21:50.000Z" itemprop="datePublished">2017-01-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/lucune/">lucune</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/01/27/lucune初体验/">lucune初体验</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>为了方便以后查看应用服务器的日志，我准备自行开发一个提供全文检索功能的app。<br>apache果然无所不能，已经有了现成的解决方案。有开发包，有封装好的app。我选择了lucune这个开发包。<br>经过了几次搜索我大致了解了lucune的使用流程。第一步，也就是最关键的一步，是生成全文的索引，这涉及到了切词，不过也不用想得太麻烦，毕竟apache都已经帮我们解决了最困难的问题。<br>我们所需要做的，只是学习如何操作这个开发包。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/01/27/lucune初体验/" data-id="cj00y7kna000gi2tabqxdt4kf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/全文检索/">全文检索</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mac开发环境搭建小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/01/27/mac开发环境搭建小记/" class="article-date">
  <time datetime="2017-01-27T01:49:11.000Z" itemprop="datePublished">2017-01-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/日志/">日志</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/01/27/mac开发环境搭建小记/">mac开发环境搭建小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>悲剧，昨晚写的东西全没了。只能重新写一遍了。</p>
<p>想说的东西不多，就是买了个apple air。手感还可以，键盘没有想象中的那么糟糕。</p>
<p>系统很好用，漂亮的UI以及bash shell都很好，结合了windows的桌面和linux的快捷和强大。</p>
<p>然后就是安装了一些程序员会用到的软件包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">iTerm2 -- 强大的shell窗口，用来代替mac自身的命令行窗口，结合了imux的功能。由于暂时还不熟悉，以后再说</div><div class="line">zsh --bash的超集，方便好用的命令自动补全功能，而且还不用区分大小写</div><div class="line">oh my zsh --集成化的zsh配置，傻瓜也能用zsh了</div><div class="line">alfred --生产力提高工具，能快捷地打开程序、自动搜索文件以及url等等，感觉360的某个功能就是抄它的</div><div class="line">brew --自动化安装工具，通过brew install wget这种语法，方便快捷地安装linux程序</div><div class="line">git --必装</div><div class="line">shadowssocks --必装，科学上网的神器，配合几块钱一个月的ssh服务器，能用的很爽。另外注意配置gi代理时，协议应为socks5</div><div class="line">jdk --oracle官网有安装包，有mac版，但感觉不好用，像是自动档，都没有JAVA_HOME和CLASSPATH之类的东西。</div><div class="line">eclipse --想来想去还是装了，编译用的内存应该多点，这个小本子应该够用，这几天准备看看全文搜索。然后搭建一个日志全文检索的服务器，这样以后排查问题就方便多了</div><div class="line">tomcat --解压即可</div><div class="line"></div><div class="line">nodejs --感觉nodejs很有前途，而且脚本语言应该能在这台本子上跑得流畅一点，至少比java编译半天要好</div><div class="line">hexo --写博客必备，另外注意的是，在最新版的node环境下，安装hexo的命令比较特殊：npm install hexo --no-optional --save</div></pre></td></tr></table></figure>
<p>其他的用到之后再装吧。</p>
<p>用来来感觉很流畅，基本没有感受到卡顿。电池没有宣传的那么神，顶多用5个小时吧，就写代码和听音乐。</p>
<p>其他就没有什么了。</p>
<p>另外这次放假，需要完成的目标有：</p>
<ul>
<li>熟悉lucune这个全文检索开发包</li>
<li>写小说，至少写个3万字吧。真的应该开始赚点零花钱了，工资只有那么点钱，根本不够用。</li>
<li>熟悉mac系统，撰写各种方便开发的脚本。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/01/27/mac开发环境搭建小记/" data-id="cj00y7knc000ki2ta9u64v50a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/mac/">mac</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-动态数据源路由容易掉进去的坑" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/01/24/动态数据源路由容易掉进去的坑/" class="article-date">
  <time datetime="2017-01-23T22:19:27.000Z" itemprop="datePublished">2017-01-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/zjipst/">zjipst</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/01/24/动态数据源路由容易掉进去的坑/">动态数据源路由容易掉进去的坑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><p>由于业务要求需要在不同的生产库、查询库（查询库中又包含多个子查询库）之间动态切换，所以使用了Spring提供的动态数据源路由功能。<br>这个功能的基本原理，是将具体的数据库和一个枚举类作为键值对，由Spring提供的DynamicDataSourceRouting进行管理，然后将作为key的枚举类保存在ThreadLocal中以保证线程独立。这样在业务需要时，可以动态的根据一些条件，比如用户所处的行政区划之类的变量，动态的改变当前数据源。</p>
<p>一开始，只有生产库和查询库两个数据源之间进行切换，后来根据业务需求，需要分摊统计查询的压力，将查询库切分为11个地市的子查询库。<br>看起来，没有任何问题，只是在切换数据源时，多了一层切换操作，然后奇怪的问题发生了：本来应该插入到生产库的数据，被随机地插入到了不同的子查询库中。</p>
<h4 id="代码还原"><a href="#代码还原" class="headerlink" title="代码还原"></a>代码还原</h4><p>以下是精简之后的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//生产库、查询库所对应的key</div><div class="line">public enum DataSourceKind&#123;</div><div class="line">    READ, WRITE</div><div class="line">&#125;</div><div class="line"></div><div class="line">//各个查询库所对应的key</div><div class="line">public enum ReadDataSourceKind&#123;</div><div class="line">    NingBo, WenZhou, JiaXing, ShaoXing...//略</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//持有ThreadLocal的类，提供对于线程独立变量的访问</div><div class="line">public class DataSourceHolder&#123;</div><div class="line">    private static final ThreadLocal&lt;DataSourceKind&gt; dataSource = new ThreadLocal&lt;DataSourceKind&gt;();</div><div class="line"></div><div class="line">    //获取当前数据源</div><div class="line">    public static DataSourceKind getDataSource()&#123; return dataSource.get();&#125;</div><div class="line">    //设置当前数据源</div><div class="line">    public static void setDataSource(DataSourceKind kind)&#123; dataSource.set(kind);&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//略过各个查询库的holder</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//继承Spring的动态数据源路由，复写获取数据源key方法</div><div class="line">public class MyDynamicDataSourceRouting extends DynamicDataSourceRouting&#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected Object determineCurrentLookupKey() &#123;</div><div class="line">        return DataSourceHolder.getDataSource();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//略过查询库的routing</div></pre></td></tr></table></figure>
<p>具体的切换用到了SpringAOP，大致就是定义一个@DbReadOnly注解，然后当检测到有方法使用了该注解，就进行数据源的切换。<br>具体的业务场景中，只有很少一部分统计分析的请求会使用查询库，并且所有的@DbReadOnly注解基本上都是在Controller层。<br>第一步先切换到READ， 然后根据当前登录用户所处行政区划来进行查询库的切换，等到这个请求完成之后，再在finally中切换回默认的生产库来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public Object proceed(Proceed obj)&#123;</div><div class="line">    DataSourceHolder.setDataSource(DataSourceKind.READ);</div><div class="line">    User user = SessionUtils.getCurrentUser();    //获取当前登录的用户</div><div class="line">    String xzqh = user.getXzqh();</div><div class="line">    if(xzqh.equals(XzqhConsts.JinHua))&#123; ReadDataSourceHolder.setDataSource(ReadDataSourceKind.JinHua);&#125;</div><div class="line">    else if(xzqh.equals(XzqhConsts.WenZhou)&#123; ReadDataSourceHolder.setDataSource(ReadDataSourceKind.WenZhou);&#125;)</div><div class="line">    ....//略</div><div class="line">    </div><div class="line">    try&#123;</div><div class="line">        return obj.proceed();</div><div class="line">    &#125;catch(Exception e)&#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;finally&#123;</div><div class="line">        DataSourceHolder.setDataSource(DataSourceKind.WRITE);    //重置为生产库</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="分析与提示"><a href="#分析与提示" class="headerlink" title="分析与提示"></a>分析与提示</h4><p>有经验的老司机大概已经看出了问题所在， 数据之所以会写入到查询库的原因实在是很可笑。<br>还没明白过来的兄弟可以先看看接下来的提示。</p>
<p>对于这个问题，我一开始根本摸不着头脑，因为在我的理解中，就算有线程没有切换回生产库，这个线程也会因为请求结束而被结束。<br>更何况涉及到查询库的那些请求根本不涉及INSERT操作。</p>
<p>更何况怎么可能不切换回生产库呢？finally中的代码无论如何，就算抛运行时异常，也应该是会执行的啊？</p>
<p>难道一个线程会被多个请求同时使用？或者ThreadLocal并不是真正的ThreadLocal?而是会在线程之间互相影响？</p>
<p>最后绝望的我甚至还开始怀疑起枚举类是否是线程安全的。</p>
<p>我也是被问题迷糊了头脑，实际上这个问题非常简单，我不过是在一堆错误的前提下做着无望的挣扎，而没有去怀疑自己所坚信的这些前提是否是成立的。</p>
<p>我觉得当遇到一个看似匪夷所思，甚至毫无可能发生的异常时，需要有清醒的头脑，来反过来质疑看似坚固的前提。</p>
<p>下面是两个小小的提示：</p>
<ul>
<li>线程真的会因为请求结束而结束吗？</li>
<li>上面finally的代码真的必然后执行吗？</li>
</ul>
<h4 id="柳暗花明"><a href="#柳暗花明" class="headerlink" title="柳暗花明"></a>柳暗花明</h4><p>很遗憾，对于上面两个问题的答案，其实都是否定的。</p>
<p>事实上，Tomcat存在一个线程池机制，对于完成了请求的线程，并不会立即释放，而是回收到线程池中；并且，很关键的一点是，tomcat并不会清空ThreadLocal变量。</p>
<p>第二个问题，非常可笑的，虽然finally的确必然会执行，然而这是有条件的：如果程序在try代码块之外抛了异常，那么finally将不会被执行。</p>
<p>至此，一切谜题的答案已经展现在眼前。</p>
<p>用户的session丢失，会导致获取xzqh那一行代码抛空指针异常，然而之前已经切换为READ库，所以当前线程已经指向了查询库，又因为抛运行时异常，所以请求结束；<br>接着，线程被回收，进入线程池；过了不知道多久，有一个倒霉的请求被分配到了这个线程上执行，然后因为数据源并不会切换到WRITE中，所以INSERT操作会进入到查询库。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>看似不可思议的问题， 既然真真切切的发生了，那么必然又一个合乎逻辑的解释；看似不可思议，不过是因为你误解了某些前提。<br>另外我这么久也没看出问题所在，仅仅是以为我基础不够，否则如果我早知道tomcat有这么玄妙的线程池机制，那么我应该很快就能想到问题的关键点所在。</p>
<p>不过，总的来说，这是一场很有趣的解谜体验。：）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/01/24/动态数据源路由容易掉进去的坑/" data-id="cj00y7knd000mi2tatbzmxlgh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/BUG/">BUG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/DynamicDataSourceRouting/">DynamicDataSourceRouting</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TOMCAT假死分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/01/05/TOMCAT假死分析/" class="article-date">
  <time datetime="2017-01-05T12:29:14.000Z" itemprop="datePublished">2017-01-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/CODE/">CODE</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/01/05/TOMCAT假死分析/">TOMCAT假死分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h4><ul>
<li>tomcat假死，无法响应任何请求。</li>
<li>CPU、内存等均无告警，假死之后CPU占用率变得很低。</li>
<li>无任何异常日志，CLOSE_WATI数正常。</li>
<li>静态资源也无法访问</li>
<li>通过命令查看线程数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ps -ef|grep tomcat --获取进程ID</div><div class="line">ps -T -p &lt;pid&gt;|wc -l -- 获取tomcat下线程数</div></pre></td></tr></table></figure>
<p>发现有近1500个线程，这已经到达tomcat线程上限。</p>
<h4 id="获取DUMP日志"><a href="#获取DUMP日志" class="headerlink" title="获取DUMP日志"></a>获取DUMP日志</h4><p>因为生产环境没有装JDK，只有JRE环境，费了好一番功夫才发现有个神奇的命令.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kill -3 &lt;pid&gt;</div></pre></td></tr></table></figure>
<p>这个命令并不会导致进程被杀，并且会将相应的线程堆栈信息和大致的内存占用情况输出到tomcat目录下的catalina.out文件中。<br>因为这个文件往往较大，所以DUMP前可以先清空这个日志文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;&quot;&gt;catalina.out -- 这个命令也可以用于运行时释放日志</div></pre></td></tr></table></figure>
<p>拿到DUMP后，问题开始明朗起来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&quot;http-bio-443-exec-1151&quot; daemon prio=10 tid=0x00007fd1c96c9000 nid=0x26cb in Object.wait() [0x00007fd0f914e000]</div><div class="line">   java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">    at java.lang.Object.wait(Native Method)</div><div class="line">        - waiting on &lt;0x00000007f5b040f8&gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)</div><div class="line">            at java.lang.Object.wait(Object.java:503)</div><div class="line">                at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1118)</div><div class="line">                    - locked &lt;0x00000007f5b040f8&gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)</div><div class="line">                        at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:106)</div><div class="line">                            at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:1044)</div><div class="line">                                at org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource.getConnection(AbstractRoutingDataSource.java:164)</div><div class="line">                                    at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:205)</div><div class="line">                                        at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373)</div><div class="line">                                            at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:420)</div><div class="line">                                                at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:257)</div><div class="line">                                                    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)</div><div class="line">                                                        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)</div><div class="line">                                                            at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:646)</div></pre></td></tr></table></figure>
<p>有近千个线程处于WAITING状态，都是卡在获取数据库连接这一步上。<br>反查数据库中的连接数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT COUNT(1) FROM GV$SESSION WHERE machine = &apos;主机名&apos;</div></pre></td></tr></table></figure>
<p>结果为100，并且这些连接全部处于INACTIVE状态，而数据库连接池配置的maxActive数就是100个。<br>说明数据库连接池泄露了。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>应用框架采用的是spring+mybatis+dbcp1.4。<br>由于并不需要手动关闭数据库连接，所以业务代码导致这个问题的可能性不大。<br>google之后发现dbcp官方JIRA上也report了这个问题，据说是一个BUG，升级到1.5.3版本能解决这个问题。<br>但是奇怪的是，应用已经正常运行两年多了，为什么最近才出现这个问题呢？<br>难道是因为割接的地市越来越多，导致服务器压力增大，进而导致这个问题的发生？<br>如果是DBCP的BUG，那么升级版本或者替换为C3P0应该能够解决这个问题。<br>但我不确定是否真的是这个原因，或许业务代码在某种极为巧合的情形下的确会导致连接无法正常关闭；那么鲁莽的行为只会掩盖这个问题，并且在日后造成更大的麻烦。<br>所以最好的解决方式是找到连接泄漏的位置。<br>通过采用DBCP配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">maxWait=5000</div><div class="line">removeAbandoned=true</div><div class="line">removeAbandonedTimeout=60</div><div class="line">logAbandoned=true</div></pre></td></tr></table></figure>
<p>来定位问题代码的位置。<br>设置的具体含义在官方文档上有，简言之，这样设置之后，在一定条件下，会触发DBCP的回收机制。当一个连接超过一定时间没有被使用，那么就视为abandoned连接，删除之，并记录下该连接的上下文和调用栈。</p>
<h4 id="继续跟踪"><a href="#继续跟踪" class="headerlink" title="继续跟踪"></a>继续跟踪</h4><p>目前连接数还没有到达指标处，继续跟踪，希望明天就能解决这个问题。</p>
<h4 id="终于找到问题了"><a href="#终于找到问题了" class="headerlink" title="终于找到问题了"></a>终于找到问题了</h4><p>很偶然的一次排查，我注意到了假死之后的tomcat的Thread Dump中，居然有一百多个线程还处于runable的状态！<br>而且这些线程全都是案件证据文件上传、下载的线程！这样一来就和FTP服务器有关了。</p>
<p>这样整个问题出现的逻辑也就清楚了，步骤如下：</p>
<ul>
<li>上传文件的方法外面使用了Spring的@Transactional注解，这样就导致只有当事务提交之后，该数据库连接才能关闭</li>
<li>FTP地址需要从数据库中获取，所以该方法会打开数据库连接；并且文件上传成功后需要在证据表中插入一条记录</li>
<li>出于某种原因，上传文件的线程无法正常结束(不可能是文件过大的原因，因为客户端会判断当文件大于30M时，会访问专门的文件服务器进行分块上传)</li>
<li>于是Spring无法关闭这个连接，这个连接一直无法被回收到连接池</li>
<li>无法关闭的连接越来越多，到达设定的上限（100个，堆栈日志相符）；应用无法再获取任何数据库连接，导致相应操作全部挂起，线程处于WAITING状态</li>
<li>等待状态的线程累计，到达tomcat分配上限，假死</li>
<li>注意，443端口还是能正常访问静态资源，这是因为不同端口实际上用的线程池并不是同一个</li>
</ul>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ul>
<li>Transactional的必要性值得怀疑</li>
<li>本质问题是为什么FTP线程无法结束，需要分析是服务器原因，还是代码原因</li>
<li>暴力解法：设定定时器，超时直接结束FTP线程</li>
</ul>
<h4 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h4><p>将FTP改为被动模式上传，问题解决。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 代码是瞎写的，意会即可</span></div><div class="line">FtpClient client = <span class="keyword">new</span> FtpClient();</div><div class="line">client.enterPasvmode();</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/01/05/TOMCAT假死分析/" data-id="cj00y7kn30009i2tas343c9n0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/dbcp/">dbcp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/tomcat/">tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2017-01-01-日志" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2017/01/01/2017-01-01-日志/" class="article-date">
  <time datetime="2017-01-01T02:29:16.000Z" itemprop="datePublished">2017-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/日志/">日志</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2017/01/01/2017-01-01-日志/">2017-01-01 日志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>新的一年开始了。</p>
<p>也好几天没写日志了。</p>
<p>几天前纠结的事情已经解决了，心境又开始变得轻松起来。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2017/01/01/2017-01-01-日志/" data-id="cj00y7kml0006i2taixajqkyl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/日志/">日志</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2016-12-27-日志" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2016/12/27/2016-12-27-日志/" class="article-date">
  <time datetime="2016-12-27T11:59:07.000Z" itemprop="datePublished">2016-12-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/日志/">日志</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2016/12/27/2016-12-27-日志/">2016-12-27 日志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感觉自己真是脆弱。<br>何时能变得心灵强大起来呢？为什经历一点点的挫折就开始怀疑起周围的一切呢？<br>果然我需要佛学的慰藉，不断磨砺心性，以便自己能够豁达地面对各种遭遇吧。</p>
<p>电信定位的问题解决了，然而并没有问什么原因，这可能会成为不解之谜了。</p>
<p>感觉工作效率低，总是忍不住去浏览一些新的技术，老是妄想自己以后有技术了会多么多么富有；然而却做的很少。<br>比如想要写一个秒级的端口扫描器，基于python实现；一开始定的方案是协程+asyncio框架，然而后者看了半天依旧费解。光是一个yeild就让我寻思半天依旧不得其门而入。</p>
<p>而且感觉最近几天身体状况都不太好，因为天气原因好几天没去跑步了。<br>内啡肽不够，整个人又开始变得很悲观。<br>书什么的也都看不进去，翻了一半的安娜卡列尼娜好久都没动了。<br>对未来不报希望，不知道将来的生活有何值得期待之处。<br>真是令人伤感。</p>
<p>杭州的天气开始变得很冷很冷，晚上就算穿着两条裤子都觉得关节有点疼。空调开不了制暖，感觉这个冬天不好过。<br>明年争取多赚点钱，然后租一个小套间，能做饭的那种，然后再谈一个女朋友；这样我的生活就能慢慢步入正规。<br>感觉我的问题就是缺乏自信。<br>当然也可能不完全对，我最缺乏的是活着的欲望，感觉一直都是随遇而安，并没有主动地想要去追求什么东西。这大概是童年的挫折养成的一种“习得性无助”吧。<br>从现在开始，改变自己。</p>
<p>说的倒是容易，改变自己。<br>世间最为困难的莫过于此。<br>我想起异域的那句名言：</p>
<blockquote>
<p>what can change the nature of a man?</p>
</blockquote>
<p>衰老而臃肿的解谜者彷徨在贫民巷，等待着无名者一次又一次的到来，而每次造访，后者——她的爱人，身上的伤痕越来越多，并且失去的记忆也越来越多。<br>最终，她所期待的只是解脱而已。</p>
<p>愈发感觉异域的世界观和故事情节很和我的胃口，然而那庞大的文字量和游戏时间已经让我无法再次完成体会。<br>或许再过一段时间，我能静下心来，去再次体会那孤独、绝望最后却伴随救赎的史诗吧。</p>
<p>我期待着那一天。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2016/12/27/2016-12-27-日志/" data-id="cj00y7kmh0004i2taxdvd4ygz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/日志/">日志</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-博客环境搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/myblog/2016/12/26/博客环境搭建/" class="article-date">
  <time datetime="2016-12-26T15:28:05.000Z" itemprop="datePublished">2016-12-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/myblog/categories/通用技术/">通用技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/myblog/2016/12/26/博客环境搭建/">hexo+ubuntu+github博客环境搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>总算把环境给搭好了。<br>架构为：hexo+github，系统为ubuntu。</p>
<h3 id="源代码管理"><a href="#源代码管理" class="headerlink" title="源代码管理"></a>源代码管理</h3><p>首先在github创建一个仓库，建立两个分支：master，gh-pages。<br>master用来存放源代码，gh-pages用来存放编译后的html静态页面文件。<br>前者手动管理，后者配置在conf中由hexo进行管理。</p>
<ul>
<li><p>创建文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir repository</div><div class="line">cd repository</div></pre></td></tr></table></figure>
</li>
<li><p>建立git环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/LiangKim/myblog.git</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这样在repository文件夹下就自动多了myblog文件夹。<br>此时该文件夹应该是空的，如果不是也可以把其中无用文件删了然后提交.</p>
<h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><ul>
<li>建立hexo环境<br>进行到此步时，默认已经安装好了nodejs，npm等依赖。如有不懂可以google之。<br>要注意的是，在ubuntu环境下，安装nodejs最好通过编译源代码安装。apt的方式总会出莫名其妙的问题。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo npm install hexo -g</div><div class="line">npm install hexo-deployer-git --save</div></pre></td></tr></table></figure>
</li>
</ul>
<p>第一行命令安装hexo环境，第二行命令安装了git插件。<br>进入myblog目录:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo init</div></pre></td></tr></table></figure></p>
<p>这一步代码执行了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://liangkim.github.io/myblog/2016/12/26/博客环境搭建/" data-id="cj00y7knh000qi2ta2sh0mcsm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/hexo/">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/shadowsocks/">shadowsocks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/myblog/tags/ubuntu/">ubuntu</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/myblog/page/2/">2</a><a class="extend next" rel="next" href="/myblog/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/CODE/">CODE</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/C程序语言设计/">C程序语言设计</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/lucune/">lucune</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/zjipst/">zjipst</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/日志/">日志</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/读书笔记/">读书笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/myblog/categories/通用技术/">通用技术</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/BUG/">BUG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/C/">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/DynamicDataSourceRouting/">DynamicDataSourceRouting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/dbcp/">dbcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/shadowsocks/">shadowsocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/全文检索/">全文检索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/日志/">日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/myblog/tags/阅读笔记/">阅读笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/myblog/tags/BUG/" style="font-size: 10px;">BUG</a> <a href="/myblog/tags/C/" style="font-size: 10px;">C</a> <a href="/myblog/tags/DynamicDataSourceRouting/" style="font-size: 10px;">DynamicDataSourceRouting</a> <a href="/myblog/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/myblog/tags/dbcp/" style="font-size: 10px;">dbcp</a> <a href="/myblog/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/myblog/tags/mac/" style="font-size: 10px;">mac</a> <a href="/myblog/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/myblog/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/myblog/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/myblog/tags/全文检索/" style="font-size: 10px;">全文检索</a> <a href="/myblog/tags/日志/" style="font-size: 20px;">日志</a> <a href="/myblog/tags/阅读笔记/" style="font-size: 10px;">阅读笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/myblog/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/myblog/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/myblog/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/myblog/archives/2016/12/">十二月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/myblog/2017/03/06/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/myblog/2017/02/05/如何阅读一本书/">如何阅读一本书</a>
          </li>
        
          <li>
            <a href="/myblog/2017/02/05/C程序设计语言：第一章/">C程序设计语言：第一章</a>
          </li>
        
          <li>
            <a href="/myblog/2017/01/27/lucune初体验/">lucune初体验</a>
          </li>
        
          <li>
            <a href="/myblog/2017/01/27/mac开发环境搭建小记/">mac开发环境搭建小记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 LiangKim<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/myblog/" class="mobile-nav-link">Home</a>
  
    <a href="/myblog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/myblog/fancybox/jquery.fancybox.css">
  <script src="/myblog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/myblog/js/script.js"></script>

  </div>
</body>
</html>